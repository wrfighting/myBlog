---
layout: post
title: express源码解析
tags:
- nodejs
- express
categories: nodejs
description: express是nodejs里非常流行的一个web框架，本文从头开始分析express源码，并沿着主线走通整个流程，包括初始化，路由中间件机制等。
---
## 前言
express是nodejs里非常流行的一个web框架，本文从头开始分析express源码，并沿着主线走通整个流程，包括初始化，路由中间件机制等，为了让js基础不扎实的同学也能看懂代码。

## 版本说明
本文基于的express版本为4.15.3 。

## express源码目录结构说明
express的源代码位于/lib文件夹下，结构如下图所示：

![](https://github.com/wrfighting/myBlog/blob/master/images/express/express-code-structure.png)

这里一句话概括一下各个文件的作用，具体的内容会在后面讲解，比如具体的router、route、layer的关系等会在后面内容进行讲解。

**express.js**  是主要入口，类似于index.js，这里集合了各个模块，暴露出对外的构造方法。

**application.js**  是为app进行扩充，添加了很多方法。

**request.js**  为req对象添加了各种方法，req指向了http.IncomingMessage的原型。

**response.js**  为res对象添加了各种方法，res指向了http.ServerResponse的原型。

**router/index.js**  是router的主要文件。

**router/layer.js** 是layer这个数据结构的主要文件，这个数据结构是路由部分的关键数据结构。

**router/route.js** 是route的主要文件。

**middleware/init.js** 是express自带的中间件初始化。

**middleware/query.js** 是express自带中间件的一些辅助方法。

**utils.js** 是工具类。

**view.js** 是视图（模板）的文件，这个是帮助定和处理义express视图的。